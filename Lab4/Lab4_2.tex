\paragraph*{Планировщик траектории}$\phantom{-}$\\
\hspace*{\parindent} Основной задачей планирования траектории является поиск непрерывного закона движения манипулятора, а именно параметризация пути временем:
\begin{equation}\label{eq:model}
    \begin{bmatrix}
    q_{1} \\
    q_{2} \\
    q_{3} \\
    \end{bmatrix}
    =
     \begin{bmatrix}
    q_{1}(t) \\
    q_{2}(t) \\
    q_{3}(t) \\
    \end{bmatrix}
\end{equation} 
Закон движения нужен в первую очередь, чтобы звенья манипулятора двигались согласованно, то есть в начальный и конечный момент времени все звенья начинали и заканчивали свое движение одновременно.
При этом для планирования траектории необходимо знать динамические ограничения системы, а именно максимальную скорость и ускорение выходных валов редукторов в сочленениях: $q_{i_{max}}$ и $\dot{q}_{i_{max}}$\\
Рассмотрим задачу перемещения манипулятора из одной конфигурации в (Point to Point). При этом известны только граничные значения обобщенных координат и скоростей: $q_s=q(0)$, $\dot{q}_s=\dot{q}(t_0)$, $q_f=q(t_f)$, $\dot{q}_f=\dot{q}(t_f)$, где $t_0$ $t_f$ - начальное и конечное время соответственно. Необходимо найти значение обобщенных координат манипулятора в каждый момент времени $t\in [t_0, t_f]$.
\begin{center}
    \includegraphics[width=0.45\textwidth]{Lab4/images/trjPlanningbetweenPoint.pdf}\\
    \centering{Рис 1.1 Граничные условия для планирования траектории.}
\end{center}

\paragraph*{Сплайн интерполяция}$\phantom{-}$\\

Одним из самых распространенных подходов планирования траектории является сплайн-интерполяция. Рассмотрим основную идею процесса интерполяции сплайном с точки зрения лин. алгебры. В рамках нашей задачи ограничимся интерполяцией сплайном третьей степени, ввиду зашумленности измерения ускорений двигателя и как следствие невозможности управления ими. В таком случае уравнение движения для каждого звена манипулятора $q_i(t)$ задается следующим образом:
\begin{equation}\label{eq:model}
q_i(t)=a_{i,1}\cdot t^3  + a_{i,2}\cdot t^2 + a_{i,3}\cdot t + a_{i,4}
\end{equation}
, где $a_{i,1}, a_{i,2}, a_{i,3}, a_{i,4}$ - неизвестные коэффициенты полинома.
Продифференцируем его для получения угловых скоростей и получим:
\begin{equation}\label{eq:model}
\dot{q}_i(t)=3a_{i,1}\cdot t^2  + 2a_{i,2}\cdot t + a_{i,3}
\end{equation}


\begin{center}
    \includegraphics[width=\textwidth]{Lab4/images/cubicTrjPlanning.pdf}\\
    \centering{Рис 1.2 Интерполяция кубическим сплайном.}
\end{center}

Теперь вспомним о том, что нам известны начальные и конечные значения обобщенных координат и скоростей: $q_{i_{s}}, q_{i_{f}},\dot{q}_{i_{s}}, \dot{q}_{i_{f}}$, а также времени $t_s$ и $t_f$ подставив их в уравнения сформируем систему:
\begin{equation}\label{eq:model}
\systeme*{
q_{i_{s}}=a_{i,1}\cdot t_s^3  + a_{i,2}\cdot t_s^2 + a_{i,3}\cdot t_s + a_{i,4},
q_{i_{f}}=a_{i,1}\cdot t_f^3  + a_{i,2}\cdot t_f^2 + a_{i,3}\cdot t_f + a_{i,4},
\dot{q}_{i_{s}}=3a_{i,1}\cdot t_s^2  + 2a_{i,2}\cdot t_s + a_{i,3},
\dot{q}_{i_{f}}=3a_{i,1}\cdot t_f^2  + 2a_{i,2}\cdot t_f + a_{i,3}
}
\end{equation}
Теперь перейдем непосредственно к интерполяции. Чтобы найти закон движения (1) для каждого звена необходимо определить коэффициенты $a_{i,1}, a_{i,2}, a_{i,3}, a_{i,4}$. Как видно из уравнений выше, если принять в них эти коэффициенты как неизвестные параметры, то получится так, что мы имеем \textbf{4 уравнения и 4 неизвестных параметра}.
Таким образом, мы однозначно сможем разрешить систему уравнений относительно параметров $a_{i,1}, a_{i,2}, a_{i,3}, a_{i,4}$.
Воспользуемся для этого матричным представлением системы линейных алгебраических уравнений:
\begin{equation}\label{eq:model}
     \begin{bmatrix}
    q_{i_{s}} \\
    q_{i_{f}} \\
    \dot{q}_{i_{s}} \\
    \dot{q}_{i_{f}} \\
    \end{bmatrix}
    =
    \begin{bmatrix}
    t^3_s & t^2_s & t_s & 1\\
    t^3_f & t^2_f & t_f & 1\\
    3t^2_s & 2t_s & 1 & 0\\
    3t^2_f & 2t_f & 1 & 0\\
    \end{bmatrix}
    \begin{bmatrix}
    a_{i,1}\\
    a_{i,2}\\
    a_{i,3}\\
    a_{i,4}\\
    \end{bmatrix}
\end{equation}
Перепишем данное выражение в удобном для представления виде:
\begin{equation}\label{eq:model}
b_i = M_i a_i
\end{equation}
, где $M$ - матрица коэффициентов, $a_i=[a_{i,1}, a_{i,2}, a_{i,3}, a_{i,4}]^T$ - вектор искомых параметров,  $b_i=[q_{i_{s}}, q_{i_{f}}, \dot{q}_{i_{s}}, \dot{q}_{i_{f}}]^T$ - вектор граничных условий.
Теперь можно найти вектор параметров $a_i$, обратив матрицу $M_i$:
\begin{equation}\label{eq:model}
a_i = M_i^{-1} b_i 
\end{equation}
Вернемся снова к уравнению движения отдельного звена манипулятора (2) и подставим теперь уже известные из выражения (7) коэффициенты $a_i=[a_{i,1}, a_{i,2}, a_{i,3}, a_{i,4}]$:
\begin{equation}\label{eq:model}
q_i(t)=
    \begin{bmatrix}
    a_{i,1} & a_{i,2} & a_{i,3} & a_{i,4}
    \end{bmatrix}
    \begin{bmatrix}
    t^3\\
    t^2\\
    t\\
    1\\
    \end{bmatrix}
\end{equation}
Данное выражение можно определить для оставшихся звеньев манипулятора при тех же $t_f$,$t_s$ и соответствующих $q_{i_{s}}$,$q_{i_{f}}$.
В итоге уравнение движения трехзвенного манипулятора будет записано в следующем виде:
\begin{equation}\label{eq:model}
\begin{bmatrix}
    q_1(t)\\
    q_2(t)\\
    q_3(t)\\
\end{bmatrix}
    =
\begin{bmatrix}
    a_{1,1} & a_{1,2} & a_{1,3} & a_{1,4}\\
    a_{2,1} & a_{2,2} & a_{2,3} & a_{2,4}\\
    a_{3,1} & a_{3,2} & a_{3,3} & a_{3,4}\\
\end{bmatrix}
\begin{bmatrix}
    t^3\\
    t^2\\
    t\\
    1\\
    \end{bmatrix}
\end{equation}

Стоит отметить, что выбирая $\Delta t=t_f - t_s$ нужно учесть $\dot{q}_{i_{max}}$ и $\ddot{q}_{i_{max}}$

\paragraph*{Метод линейных сегментов с параболическими частями(LSPB)}$\phantom{-}$\\

Другим наиболее распространенным способом генерации траектории является метод линейных сегментов с параболическими частями. В английской литературе данный метод можно встретить под названием  "Linear segments with parabolic blends".\\

Уравнение движения для данного метода состоит из трех частей:\\ 1)равноускоренное движение ($\ddot{q_i}=const,\ddot{q_i}>0$).\\
2)равномерное движение($\dot{q_i}=const$).\\
3)равнозамедленное движение($\ddot{q_i}=const,\ddot{q_i}<0$).\\


